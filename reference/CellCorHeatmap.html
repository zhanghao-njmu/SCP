<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function generates a heatmap to visualize the similarity between different cell types or conditions. It takes in Seurat objects or expression matrices as input and calculates pairwise similarities or distance."><title>CellCorHeatmap — CellCorHeatmap • SCP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="CellCorHeatmap — CellCorHeatmap"><meta property="og:description" content="This function generates a heatmap to visualize the similarity between different cell types or conditions. It takes in Seurat objects or expression matrices as input and calculates pairwise similarities or distance."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/zhanghao-njmu/SCP">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>CellCorHeatmap</h1>
      <small class="dont-index">Source: <a href="https://github.com/zhanghao-njmu/SCP/blob/HEAD/R/SCP-plot.R" class="external-link"><code>R/SCP-plot.R</code></a></small>
      <div class="d-none name"><code>CellCorHeatmap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function generates a heatmap to visualize the similarity between different cell types or conditions. It takes in Seurat objects or expression matrices as input and calculates pairwise similarities or distance.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CellCorHeatmap</span><span class="op">(</span></span>
<span>  <span class="va">srt_query</span>,</span>
<span>  srt_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bulk_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_reduction <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_reduction <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  ref_dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  query_collapsing <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">query_group</span><span class="op">)</span>,</span>
<span>  ref_collapsing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  features_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HVF"</span>, <span class="st">"DE"</span><span class="op">)</span>,</span>
<span>  feature_source <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  DEtest_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max.cells.per.ident <span class="op">=</span> <span class="fl">200</span>, test.use <span class="op">=</span> <span class="st">"wilcox"</span><span class="op">)</span>,</span>
<span>  DE_threshold <span class="op">=</span> <span class="st">"p_val_adj &lt; 0.05"</span>,</span>
<span>  distance_metric <span class="op">=</span> <span class="st">"cosine"</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  filter_lowfreq <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"KNNPredict"</span>,</span>
<span>  exp_legend_title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  flip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  limits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_row_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  row_names_side <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>  column_names_side <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>  row_names_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  column_names_rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  row_title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  column_title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row_title_side <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>  column_title_side <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>  row_title_rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  column_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nlabel <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  label_cutoff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  label_by <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>  label_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  heatmap_palette <span class="op">=</span> <span class="st">"RdBu"</span>,</span>
<span>  heatmap_palcolor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_group_palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>  query_group_palcolor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_group_palette <span class="op">=</span> <span class="st">"simspec"</span>,</span>
<span>  ref_group_palcolor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_cell_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_cell_annotation_palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>  query_cell_annotation_palcolor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_cell_annotation_params <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">flip</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="kw">else</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ref_cell_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_cell_annotation_palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>  ref_cell_annotation_palcolor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_cell_annotation_params <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">flip</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="kw">else</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  use_raster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  raster_device <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>  raster_by_magick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  height <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  width <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"inch"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">11</span>,</span>
<span>  ht_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>srt_query</dt>
<dd><p>A Seurat object or count matrix representing the query dataset. This dataset will be used to calculate the similarities between cells.</p></dd>


<dt>srt_ref</dt>
<dd><p>A Seurat object or count matrix representing the reference dataset. If provided, the similarities will be calculated between cells from the query and reference datasets. If not provided, the similarities will be calculated within the query dataset.</p></dd>


<dt>bulk_ref</dt>
<dd><p>A count matrix representing bulk data. If provided, the similarities will be calculated between cells from the query dataset and bulk data.</p></dd>


<dt>query_group</dt>
<dd><p>The grouping variable in the query dataset. This variable will be used to group cells in the heatmap rows. If not provided, all cells will be treated as one group.</p></dd>


<dt>ref_group</dt>
<dd><p>The grouping variable in the reference dataset. This variable will be used to group cells in the heatmap columns. If not provided, all cells will be treated as one group.</p></dd>


<dt>query_assay</dt>
<dd><p>The assay to use for the query dataset. If not provided, the default assay of the query dataset will be used.</p></dd>


<dt>ref_assay</dt>
<dd><p>The assay to use for the reference dataset. If not provided, the default assay of the reference dataset will be used.</p></dd>


<dt>query_reduction</dt>
<dd><p>The dimensionality reduction method to use for the query dataset. If not provided, no dimensionality reduction will be applied to the query dataset.</p></dd>


<dt>ref_reduction</dt>
<dd><p>The dimensionality reduction method to use for the reference dataset. If not provided, no dimensionality reduction will be applied to the reference dataset.</p></dd>


<dt>query_dims</dt>
<dd><p>The dimensions to use for the query dataset. If not provided, the first 30 dimensions will be used.</p></dd>


<dt>ref_dims</dt>
<dd><p>The dimensions to use for the reference dataset. If not provided, the first 30 dimensions will be used.</p></dd>


<dt>query_collapsing</dt>
<dd><p>Whether to collapse cells within each query group before calculating similarities. If set to TRUE, the similarities will be calculated between query groups rather than individual cells.</p></dd>


<dt>ref_collapsing</dt>
<dd><p>Whether to collapse cells within each reference group before calculating similarities. If set to TRUE, the similarities will be calculated between reference groups rather than individual cells.</p></dd>


<dt>features</dt>
<dd><p>A vector of feature names to include in the heatmap. If not provided, a default set of highly variable features (HVF) will be used.</p></dd>


<dt>features_type</dt>
<dd><p>The type of features to use. Options are "HVF" for highly variable features, "DE" for differentially expressed features between query and reference groups.</p></dd>


<dt>feature_source</dt>
<dd><p>The source of features to use. Options are "query" to use only features from the query dataset, "ref" to use only features from the reference dataset, or "both" to use features from both datasets. If not provided or set to "both", features will be selected from both datasets.</p></dd>


<dt>nfeatures</dt>
<dd><p>The maximum number of features to include in the heatmap. If not provided, the default is 2000.</p></dd>


<dt>DEtest_param</dt>
<dd><p>The parameters to use for differential expression testing. This should be a list with two elements: "max.cells.per.ident" specifying the maximum number of cells per group for differential expression testing, and "test.use" specifying the statistical test to use for differential expression testing. If not provided, the default parameters will be used.</p></dd>


<dt>DE_threshold</dt>
<dd><p>The threshold for differential expression. Only features with adjusted p-values below this threshold will be considered differentially expressed.</p></dd>


<dt>distance_metric</dt>
<dd><p>The distance metric to use for calculating similarities between cells. This can be any of the following: "cosine", "pearson", "spearman", "correlation", "jaccard", "ejaccard", "dice", "edice", "hamman", "simple matching", or "faith". If not provided, the default is "cosine".</p></dd>


<dt>k</dt>
<dd><p>The number of nearest neighbors to use for calculating similarities. If not provided, the default is 30.</p></dd>


<dt>filter_lowfreq</dt>
<dd><p>The minimum frequency threshold for selecting query dataset features. Features with a frequency below this threshold will be excluded from the heatmap. If not provided, the default is 0.</p></dd>


<dt>prefix</dt>
<dd><p>The prefix to use for the KNNPredict tool slot in the query dataset. This can be used to avoid conflicts with other tools in the Seurat object. If not provided, the default is "KNNPredict".</p></dd>


<dt>exp_legend_title</dt>
<dd><p>The title for the color legend in the heatmap. If not provided, a default title based on the similarity metric will be used.</p></dd>


<dt>border</dt>
<dd><p>Whether to add a border around each heatmap cell. If not provided, the default is TRUE.</p></dd>


<dt>flip</dt>
<dd><p>Whether to flip the orientation of the heatmap. If set to TRUE, the rows and columns of the heatmap will be swapped. This can be useful for visualizing large datasets in a more compact form. If not provided, the default is FALSE.</p></dd>


<dt>limits</dt>
<dd><p>The limits for the color scale in the heatmap. If not provided, the default is to use the range of similarity values.</p></dd>


<dt>cluster_rows</dt>
<dd><p>Whether to cluster the rows of the heatmap. If set to TRUE, the rows will be rearranged based on hierarchical clustering. If not provided, the default is FALSE.</p></dd>


<dt>cluster_columns</dt>
<dd><p>Whether to cluster the columns of the heatmap. If set to TRUE, the columns will be rearranged based on hierarchical clustering. If not provided, the default is FALSE.</p></dd>


<dt>show_row_names</dt>
<dd><p>Whether to show the row names in the heatmap. If not provided, the default is FALSE.</p></dd>


<dt>show_column_names</dt>
<dd><p>Whether to show the column names in the heatmap. If not provided, the default is FALSE.</p></dd>


<dt>row_names_side</dt>
<dd><p>The side of the heatmap to show the row names. Options are "left" or "right". If not provided, the default is "left".</p></dd>


<dt>column_names_side</dt>
<dd><p>The side of the heatmap to show the column names. Options are "top" or "bottom". If not provided, the default is "top".</p></dd>


<dt>row_names_rot</dt>
<dd><p>The rotation angle of the row names. If not provided, the default is 0 degrees.</p></dd>


<dt>column_names_rot</dt>
<dd><p>The rotation angle of the column names. If not provided, the default is 90 degrees.</p></dd>


<dt>row_title</dt>
<dd><p>The title for the row names in the heatmap. If not provided, the default is to use the query grouping variable.</p></dd>


<dt>column_title</dt>
<dd><p>The title for the column names in the heatmap. If not provided, the default is to use the reference grouping variable.</p></dd>


<dt>row_title_side</dt>
<dd><p>The side of the heatmap to show the row title. Options are "top" or "bottom". If not provided, the default is "left".</p></dd>


<dt>column_title_side</dt>
<dd><p>The side of the heatmap to show the column title. Options are "left" or "right". If not provided, the default is "top".</p></dd>


<dt>row_title_rot</dt>
<dd><p>The rotation angle of the row title. If not provided, the default is 90 degrees.</p></dd>


<dt>column_title_rot</dt>
<dd><p>The rotation angle of the column title. If not provided, the default is 0 degrees.</p></dd>


<dt>nlabel</dt>
<dd><p>The maximum number of labels to show on each side of the heatmap. If set to 0, no labels will be shown. This can be useful for reducing clutter in large heatmaps. If not provided, the default is 0.</p></dd>


<dt>label_cutoff</dt>
<dd><p>The similarity cutoff for showing labels. Only cells with similarity values above this cutoff will have labels. If not provided, the default is 0.</p></dd>


<dt>label_by</dt>
<dd><p>The dimension to use for labeling cells. Options are "row" to label cells by row, "column" to label cells by column, or "both" to label cells by both row and column. If not provided, the default is "row".</p></dd>


<dt>label_size</dt>
<dd><p>The size of the labels in points. If not provided, the default is 10.</p></dd>


<dt>heatmap_palette</dt>
<dd><p>The color palette to use for the heatmap. This can be any of the palettes available in the circlize package. If not provided, the default is "RdBu".</p></dd>


<dt>heatmap_palcolor</dt>
<dd><p>The specific colors to use for the heatmap palette. This should be a vector of color names or RGB values. If not provided, the default is NULL.</p></dd>


<dt>query_group_palette</dt>
<dd><p>The color palette to use for the query group legend. This can be any of the palettes available in the circlize package. If not provided, the default is "Paired".</p></dd>


<dt>query_group_palcolor</dt>
<dd><p>The specific colors to use for the query group palette. This should be a vector of color names or RGB values. If not provided, the default is NULL.</p></dd>


<dt>ref_group_palette</dt>
<dd><p>The color palette to use for the reference group legend. This can be any of the palettes available in the circlize package. If not provided, the default is "simspec".</p></dd>


<dt>ref_group_palcolor</dt>
<dd><p>The specific colors to use for the reference group palette. This should be a vector of color names or RGB values. If not provided, the default is NULL.</p></dd>


<dt>query_cell_annotation</dt>
<dd><p>A vector of cell metadata column names or assay feature names to use for highlighting specific cells in the heatmap. Each element of the vector will create a separate cell annotation track in the heatmap. If not provided, no cell annotations will be shown.</p></dd>


<dt>query_cell_annotation_palette</dt>
<dd><p>The color palette to use for the query cell annotation tracks. This can be any of the palettes available in the circlize package. If a single color palette is provided, it will be used for all cell annotation tracks. If multiple color palettes are provided, each track will be assigned a separate palette. If not provided, the default is "Paired".</p></dd>


<dt>query_cell_annotation_palcolor</dt>
<dd><p>The specific colors to use for the query cell annotation palettes. This should be a list of vectors, where each vector contains the colors for a specific cell annotation track. If a single color vector is provided, it will be used for all cell annotation tracks. If multiple color vectors are provided, each track will be assigned a separate color vector. If not provided, the default is NULL.</p></dd>


<dt>query_cell_annotation_params</dt>
<dd><p>Additional parameters for customizing the appearance of the query cell annotation tracks. This should be a list with named elements, where the names correspond to parameter names in the heatmaps_annotation() function from the ComplexHeatmap package. If not provided, the default parameters will be used.</p></dd>


<dt>ref_cell_annotation</dt>
<dd><p>A vector of cell metadata column names or assay feature names to use for highlighting specific cells in the heatmap. Each element of the vector will create a separate cell annotation track in the heatmap. If not provided, no cell annotations will be shown.</p></dd>


<dt>ref_cell_annotation_palette</dt>
<dd><p>The color palette to use for the reference cell annotation tracks. This can be any of the palettes available in the circlize package. If a single color palette is provided, it will be used for all cell annotation tracks. If multiple color palettes are provided, each track will be assigned a separate palette. If not provided, the default is "Paired".</p></dd>


<dt>ref_cell_annotation_palcolor</dt>
<dd><p>The specific colors to use for the reference cell annotation palettes. This should be a list of vectors, where each vector contains the colors for a specific cell annotation track. If a single color vector is provided, it will be used for all cell annotation tracks. If multiple color vectors are provided, each track will be assigned a separate color vector. If not provided, the default is NULL.</p></dd>


<dt>ref_cell_annotation_params</dt>
<dd><p>Additional parameters for customizing the appearance of the reference cell annotation tracks. This should be a list with named elements, where the names correspond to parameter names in the heatmaps_annotation() function from the ComplexHeatmap package. If not provided, the default parameters will be used.</p></dd>


<dt>use_raster</dt>
<dd><p>Whether to use raster images for rendering the heatmap. If set to TRUE, the heatmap will be rendered as a raster image using the raster_device argument. If not provided, the default is determined based on the number of rows and columns in the heatmap.</p></dd>


<dt>raster_device</dt>
<dd><p>The raster device to use for rendering the heatmap. This should be a character string specifying the device name, such as "png", "jpeg", or "pdf". If not provided, the default is "png".</p></dd>


<dt>raster_by_magick</dt>
<dd><p>Whether to use the magick package for rendering rasters. If set to TRUE, the magick package will be used instead of the raster package. This can be useful for rendering large heatmaps more efficiently. If the magick package is not installed, this argument will be ignored.</p></dd>


<dt>height</dt>
<dd><p>The height of the heatmap in the specified units. If not provided, the height will be automatically determined based on the number of rows in the heatmap and the default unit.</p></dd>


<dt>width</dt>
<dd><p>The width of the heatmap in the specified units. If not provided, the width will be automatically determined based on the number of columns in the heatmap and the default unit.</p></dd>


<dt>units</dt>
<dd><p>The units to use for the width and height of the heatmap. Options are "mm", "cm", or "inch". If not provided, the default is "inch".</p></dd>


<dt>seed</dt>
<dd><p>The random seed to use for reproducible results. If not provided, the default is 11.</p></dd>


<dt>ht_params</dt>
<dd><p>Additional parameters to customize the appearance of the heatmap. This should be a list with named elements, where the names correspond to parameter names in the Heatmap() function from the ComplexHeatmap package. Any conflicting parameters will override the defaults set by this function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with the following elements:</p>
<p></p>
<ul><li><p><code>plot</code>The heatmap plot as a ggplot object.</p></li>
<li><p><code>features</code>The features used in the heatmap.</p></li>
<li><p><code>simil_matrix</code>The similarity matrix used to generate the heatmap.</p></li>
<li><p><code>simil_name</code>The name of the similarity metric used to generate the heatmap.</p></li>
<li><p><code>cell_metadata</code>The cell metadata used to generate the heatmap.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="RunKNNMap.html">RunKNNMap</a></code> <code><a href="RunKNNPredict.html">RunKNNPredict</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pancreas_sub"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pancreas_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="Standard_SCP.html">Standard_SCP</a></span><span class="op">(</span><span class="va">pancreas_sub</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:14.656618] Start Standard_SCP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:14.657785] Checking srtList... ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 1/1 of the srtList is raw_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 1/1 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use the separate HVF from srtList...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of available HVF: 2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:15.771838] Finished checking.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:15.771999] Perform ScaleData on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:15.934951] Perform linear dimension reduction (pca) on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:16.794039] Perform FindClusters (louvain) on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:16.90979] Reorder clusters...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:17.15219] Perform nonlinear dimension reduction (umap) on the data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Non-linear dimensionality reduction(umap) using Reduction(Standardpca, dims:1-13) as input</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Non-linear dimensionality reduction(umap) using Reduction(Standardpca, dims:1-13) as input</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:23.731653] Standard_SCP done</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Elapsed time: 9.08 secs </span>
<span class="r-in"><span><span class="va">ht1</span> <span class="op">&lt;-</span> <span class="fu">CellCorHeatmap</span><span class="op">(</span>srt_query <span class="op">=</span> <span class="va">pancreas_sub</span>, query_group <span class="op">=</span> <span class="st">"SubCellType"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the HVF to calculate distance metric.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 2000 features to calculate distance.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected query data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected reference data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculate similarity...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 'raw' method to find neighbors.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Predict cell type...</span>
<span class="r-in"><span><span class="va">ht1</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="CellCorHeatmap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"panc8_sub"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Simply convert genes from human to mouse and preprocess the data</span></span></span>
<span class="r-in"><span><span class="va">genenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.unique.html" class="external-link">make.unique</a></span><span class="op">(</span><span class="fu"><a href="capitalize.html">capitalize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">panc8_sub</span><span class="op">)</span>, force_tolower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">panc8_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="RenameFeatures.html">RenameFeatures</a></span><span class="op">(</span><span class="va">panc8_sub</span>, newnames <span class="op">=</span> <span class="va">genenames</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Rename features for the assay: RNA</span>
<span class="r-in"><span><span class="va">panc8_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="check_srtMerge.html">check_srtMerge</a></span><span class="op">(</span><span class="va">panc8_sub</span>, batch <span class="op">=</span> <span class="st">"tech"</span><span class="op">)</span><span class="op">[[</span><span class="st">"srtMerge"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:26.688808] Spliting srtMerge into srtList by column tech... ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:27.941587] Checking srtList... ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 1/5 of the srtList is raw_normalized_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 1/5 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 2/5 of the srtList is raw_normalized_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 2/5 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 3/5 of the srtList is raw_normalized_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 3/5 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 4/5 of the srtList is raw_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 4/5 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 5/5 of the srtList is raw_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 5/5 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use the separate HVF from srtList...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of available HVF: 2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-10-26 13:44:31.573516] Finished checking.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ht2</span> <span class="op">&lt;-</span> <span class="fu">CellCorHeatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  srt_query <span class="op">=</span> <span class="va">pancreas_sub</span>, srt_ref <span class="op">=</span> <span class="va">panc8_sub</span>, nlabel <span class="op">=</span> <span class="fl">3</span>, label_cutoff <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  query_group <span class="op">=</span> <span class="st">"SubCellType"</span>, ref_group <span class="op">=</span> <span class="st">"celltype"</span>,</span></span>
<span class="r-in"><span>  query_cell_annotation <span class="op">=</span> <span class="st">"Phase"</span>, query_cell_annotation_palette <span class="op">=</span> <span class="st">"Set2"</span>,</span></span>
<span class="r-in"><span>  ref_cell_annotation <span class="op">=</span> <span class="st">"tech"</span>, ref_cell_annotation_palette <span class="op">=</span> <span class="st">"Set3"</span>,</span></span>
<span class="r-in"><span>  width <span class="op">=</span> <span class="fl">3</span>, height <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the HVF to calculate distance metric.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 631 features to calculate distance.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected query data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected reference data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculate similarity...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 'raw' method to find neighbors.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Predict cell type...</span>
<span class="r-in"><span><span class="va">ht2</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="CellCorHeatmap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ht3</span> <span class="op">&lt;-</span> <span class="fu">CellCorHeatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  srt_query <span class="op">=</span> <span class="va">pancreas_sub</span>, srt_ref <span class="op">=</span> <span class="va">panc8_sub</span>,</span></span>
<span class="r-in"><span>  query_group <span class="op">=</span> <span class="st">"SubCellType"</span>, query_collapsing <span class="op">=</span> <span class="cn">FALSE</span>, cluster_rows <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  ref_group <span class="op">=</span> <span class="st">"celltype"</span>, ref_collapsing <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the HVF to calculate distance metric.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 631 features to calculate distance.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected query data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected reference data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculate similarity...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 'raw' method to find neighbors.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Predict cell type...</span>
<span class="r-in"><span><span class="va">ht3</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="CellCorHeatmap-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ht4</span> <span class="op">&lt;-</span> <span class="fu">CellCorHeatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  srt_query <span class="op">=</span> <span class="va">pancreas_sub</span>, srt_ref <span class="op">=</span> <span class="va">panc8_sub</span>,</span></span>
<span class="r-in"><span>  show_row_names <span class="op">=</span> <span class="cn">TRUE</span>, show_column_names <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  query_group <span class="op">=</span> <span class="st">"SubCellType"</span>, ref_group <span class="op">=</span> <span class="st">"celltype"</span>,</span></span>
<span class="r-in"><span>  query_cell_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sox9"</span>, <span class="st">"Rbp4"</span>, <span class="st">"Gcg"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ref_cell_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sox9"</span>, <span class="st">"Rbp4"</span>, <span class="st">"Gcg"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the HVF to calculate distance metric.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 631 features to calculate distance.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected query data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected reference data type: log_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculate similarity...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use 'raw' method to find neighbors.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Predict cell type...</span>
<span class="r-in"><span><span class="va">ht4</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="CellCorHeatmap-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Hao Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

